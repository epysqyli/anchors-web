import{c as l,l as k,G as m,g as b,a as _,i as p,S,t as R,a1 as P,M as U,a2 as G,k as Z,u as J,a3 as Q,b as A,o as X,F as H,I as N,a4 as V,r as z,a5 as Y,n as ee,K as te,O as D,h as ne,j as se}from"./entry-client-aec7b634.js";import{b as B}from"./index-6d4bb87f.js";import{E as W}from"./EventWrapper-662ef2bc.js";const le=R('<div class="relative snap-start h-[100dvh] text-neutral-300"><div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 py-20 text-slate-300 shadow-slate-500 w-[90vw]"><!#><!/><p class="text-center mt-10 text-xl select-none mx-auto">No (more) posts in this feed'),re=R('<div class="relative snap-start h-full text-slate-300"><div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 p-20 text-neutral-300"><!#><!/><p class="text-center mt-10 text-lg select-none mx-auto">No (more) posts in this feed'),q=()=>[l(S,{get when(){return k(()=>m()!=null)()&&m()},get children(){const e=b(le),t=e.firstChild,s=t.firstChild,[n,r]=_(s.nextSibling);return n.nextSibling,p(t,l(B,{size:80,class:"mx-auto","stroke-width":1}),n,r),e}}),l(S,{get when(){return k(()=>m()!=null)()&&!m()},get children(){const e=b(re),t=e.firstChild,s=t.firstChild,[n,r]=_(s.nextSibling);return n.nextSibling,p(t,l(B,{size:80,class:"mx-auto","stroke-width":1}),n,r),e}})];function ie(e){return P({a:{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},c:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 7.5h1.5m-1.5 3h1.5m-7.5 3h7.5m-7.5 3h7.5m3-9h3.375c.621 0 1.125.504 1.125 1.125V18a2.25 2.25 0 0 1-2.25 2.25M16.5 7.5V18a2.25 2.25 0 0 0 2.25 2.25M16.5 7.5V4.875c0-.621-.504-1.125-1.125-1.125H4.125C3.504 3.75 3 4.254 3 4.875V18a2.25 2.25 0 0 0 2.25 2.25h13.5M6 7.5h3v3H6v-3Z"/>'},e)}const L=e=>{const t=()=>{e.mergeEnrichedEvents(),e.setShowPopup(!1),e.topEventRef.htmlRef.scrollIntoView({behavior:"smooth"})};return l(G,{get children(){return l(S,{get when(){return e.showPopup()},get children(){return l(U.div,{animate:{opacity:[.5,.9,1],scale:[.5,1.05,1]},exit:{scale:[1.05,1,0],opacity:[1,.9,.5]},onClick:t,class:"bg-slate-700 text-slate-100 p-4 cursor-pointer rounded-full animate-pulse",get children(){return l(ie,{size:28,color:"white"})}})}})}})},oe=R('<div class="absolute bottom-[9dvh] right-5">'),ae=R('<div class="relative snap-start h-[100dvh]"><div class="w-[90vw] absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 py-20 text-neutral-300 bg-slate-700 active:bg-slate-600 rounded-3xl"><!#><!/><p class="text-center mt-10 text-lg select-none">load older posts'),ce=R('<div class="snap-y snap-mandatory overflow-scroll overflow-x-hidden h-[100vh]"><!#><!/><!#><!/>'),de=R('<div class="relative snap-start h-full text-slate-300"><div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 cursor-pointer p-20 border rounded-full border-slate-600 hover:shadow-lg shadow-slate-500 active:shadow-none active:border-slate-800"><!#><!/><p class="text-center mt-10 text-lg select-none">load older posts'),ue=R('<div class="relative h-full animate-scale-on-load"><div class="absolute top-3 right-8"></div><div><!#><!/><!#><!/>'),we=e=>{const t=J(Q),[s,n]=A([]),[r,c]=A(),u=(i,d,o)=>{n([...s(),{htmlRef:i,eventID:d,createdAt:o}].sort((w,x)=>w.createdAt>x.createdAt?-1:1))},v=()=>t.showOverlay()?"xl:custom-scrollbar snap-y snap-mandatory overflow-hidden h-full":"xl:custom-scrollbar snap-y snap-mandatory overflow-x-hidden h-full",I=i=>{r().scrollBy({behavior:"smooth",top:i=="up"?-1e3:1e3})};return X(async()=>{e.mostRecentOlderEventIndex()&&s()[e.mostRecentOlderEventIndex()].htmlRef.scrollIntoView(m()!=null&&m()?{}:{behavior:"smooth"})}),[l(S,{get when(){return k(()=>m()!=null)()&&m()},get children(){return[(()=>{const i=b(oe);return p(i,l(L,{get topEventRef(){return s()[0]},get showPopup(){return e.showPopup},get setShowPopup(){return e.setShowPopup},get mergeEnrichedEvents(){return e.mergeEnrichedEvents}})),i})(),(()=>{const i=b(ce),d=i.firstChild,[o,w]=_(d.nextSibling),x=o.nextSibling,[h,C]=_(x.nextSibling);return p(i,l(H,{get each(){return e.enrichedEvents()},children:E=>l(W,{addHtmlRef:u,event:E})}),o,w),p(i,l(S,{get when(){return k(()=>!!e.enrichedEvents().length)()&&!e.isFeedOver()},get fallback(){return l(q,{})},get children(){const E=b(ae),y=E.firstChild,a=y.firstChild,[f,g]=_(a.nextSibling);return f.nextSibling,N(y,"click",e.loadOlderPosts,!0),p(y,l(V,{size:60,class:"mx-auto"}),f,g),z(),E}}),h,C),i})()]}}),l(S,{get when(){return k(()=>m()!=null)()&&!m()},get children(){const i=b(ue),d=i.firstChild,o=d.nextSibling,w=o.firstChild,[x,h]=_(w.nextSibling),C=x.nextSibling,[E,y]=_(C.nextSibling);return p(d,l(L,{get topEventRef(){return s()[0]},get showPopup(){return e.showPopup},get setShowPopup(){return e.setShowPopup},get mergeEnrichedEvents(){return e.mergeEnrichedEvents}})),Y(a=>c(a),o),p(o,l(H,{get each(){return e.enrichedEvents()},children:a=>l(W,{event:a,scrollPage:I,addHtmlRef:u})}),x,h),p(o,l(S,{get when(){return k(()=>!!e.enrichedEvents().length)()&&!e.isFeedOver()},get fallback(){return l(q,{})},get children(){const a=b(de),f=a.firstChild,g=f.firstChild,[T,F]=_(g.nextSibling);return T.nextSibling,N(f,"click",e.loadOlderPosts,!0),p(f,l(V,{size:60,class:"mx-auto"}),T,F),z(),a}}),E,y),ee(()=>te(o,v())),i}})]};Z(["click"]);const he=(e,t)=>{const s=t.map(c=>c.id),n=e.map(c=>c.id),r=s.filter(c=>!n.includes(c));return t.filter(c=>r.includes(c.id))},ve=(e,t)=>{const s=t.map(r=>r.pubkey),n=e.map(r=>r.pubkey);return s.filter(r=>!n.includes(r))},fe=(e,t)=>{let s=Math.floor(Date.now()/1e3);return(t.length||e.length)&&(s=t.length==0?e[0].created_at:t[0].created_at),s},j=(e,t,s)=>{const n={rootOnly:!0,isAnchorsMode:t,filter:{limit:e.fetchEventsLimit},fetchRepostEvents:!0};return e.searchParams!=null&&(n.feedSearchParams=e.searchParams),e.nostrRefTag!=null&&(n.filter={...n.filter,"#r":[e.nostrRefTag]}),e.nostrHashTag!=null&&(n.filter={...n.filter,"#r":[e.nostrHashTag]}),e.userID!=null&&(n.filter={...n.filter,authors:[e.userID]}),s!=null&&(n.filter={...n.filter,since:s+1}),n},xe=async(e,t,s,n,r,c,u,v,I,i,d,o,w,x,h)=>{t(!0),n(await e.fetchTextEvents(j(h,w())));let C={authors:[...new Set(s().map(a=>a.pubkey))]};h.searchParams?.following=="on"&&(C={authors:e.following}),c(await e.fetchEventsMetadata(C,h.specificRelays));const E=s().map(a=>({kinds:[D.Reaction],"#e":[a.id]}));return v(await e.fetchEventsReactions(E,h.specificRelays)),i(e.buildEnrichedEvents(s(),r(),u())),t(!1),setInterval(async()=>{let a=fe(I(),d()),f=[];if(f=await e.fetchTextEvents(j(h,w(),a)),f.length!==0){const g=he(s(),f);n([...s(),...g]);const T=ve(s(),g);if(T.length!==0){const $={authors:[...new Set(T)]},O=await e.fetchEventsMetadata($);c([...r(),...O])}const K=(await e.fetchEventsReactions(g.map($=>({kinds:[D.Reaction],"#e":[$.id]})))).filter($=>!u().find(O=>O.eventID===$.eventID));v([...u(),...K]);const M=d().length+g.length;if(M>=h.maxEventsCount){const $=[...d(),...e.buildEnrichedEvents(g,r(),u())].sort(ne).slice(M-h.maxEventsCount,M);o($)}else o([...d(),...e.buildEnrichedEvents(g,r(),u())]);x(!0)}},e.FETCH_INTERVAL_MS)},Ee=async(e,t,s,n,r)=>{let u={until:n()[n().length-1].created_at,limit:t.fetchEventsLimit};t.userID&&(u={...u,authors:[t.userID]});const v=await e.fetchTextEvents({rootOnly:!0,isAnchorsMode:s(),filter:u,feedSearchParams:t.searchParams,specificRelays:t.specificRelays});if(v.length==0)return{olderEventsCount:0};const I=await e.fetchEventsMetadata({authors:v.map(o=>o.pubkey)},t.specificRelays),i=await e.fetchEventsReactions([{kinds:[D.Reaction],"#e":v.map(o=>o.id)}],t.specificRelays),d=e.buildEnrichedEvents(v,I,i);return r([...n(),...d].sort(se)),{olderEventsCount:v.length}};export{we as F,Ee as a,xe as f};
